name: Keep Multiple Cookies Alive

on:
  schedule:
    # 每隔一定时间执行一次（默认每30分钟），可根据需要调整频率
    - cron: '*/30 * * * *'
  workflow_dispatch:

jobs:
  keep-session-active:
    runs-on: ubuntu-latest
    strategy:
      # 矩阵策略，为每个站点创建一个独立的任务
      matrix:
        site: 
          - { name: "site1" }
          - { name: "site2" }
          - { name: "site3" }
          - { name: "site4" }
          - { name: "site5" }
          - { name: "site6" }
          - { name: "site7" }
          - { name: "site8" }
          - { name: "site9" }
          - { name: "site10" }
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
      
      - name: Setup cURL
        run: |
          echo "cURL version:"
          curl --version
          
      - name: Execute Custom cURL for Site 1
        if: matrix.site.name == 'site1'
        env:
          CUSTOM_CURL: ${{ secrets.SITE1_CURL }}
          SITE_NAME: site1
        run: |
          # 检查是否配置了SITE1_CURL
          if [ -z "$CUSTOM_CURL" ]; then
            echo "SITE1_CURL is not configured. Skipping..."
            exit 0
          fi
          
          echo "Executing custom cURL command for ${SITE_NAME}"
          echo "Command: ${CUSTOM_CURL}"
          
          # 设置cookie文件和响应文件
          COOKIE_FILE="${SITE_NAME}-cookies.txt"
          RESPONSE_FILE="${SITE_NAME}-last-response.json"
          
          # 执行cURL命令，添加cookie处理选项
          eval "${CUSTOM_CURL}" -c "${COOKIE_FILE}" > "${RESPONSE_FILE}"
          
          echo "${SITE_NAME}: Request completed successfully"
          
      - name: Execute Custom cURL for Site 2
        if: matrix.site.name == 'site2'
        env:
          CUSTOM_CURL: ${{ secrets.SITE2_CURL }}
          SITE_NAME: site2
        run: |
          # 检查是否配置了SITE2_CURL
          if [ -z "$CUSTOM_CURL" ]; then
            echo "SITE2_CURL is not configured. Skipping..."
            exit 0
          fi
          
          echo "Executing custom cURL command for ${SITE_NAME}"
          echo "Command: ${CUSTOM_CURL}"
          
          # 设置cookie文件和响应文件
          COOKIE_FILE="${SITE_NAME}-cookies.txt"
          RESPONSE_FILE="${SITE_NAME}-last-response.json"
          
          # 执行cURL命令，添加cookie处理选项
          eval "${CUSTOM_CURL}" -c "${COOKIE_FILE}" > "${RESPONSE_FILE}"
          
          echo "${SITE_NAME}: Request completed successfully"
          
      - name: Execute Custom cURL for Site 3
        if: matrix.site.name == 'site3'
        env:
          CUSTOM_CURL: ${{ secrets.SITE3_CURL }}
          SITE_NAME: site3
        run: |
          # 检查是否配置了SITE3_CURL
          if [ -z "$CUSTOM_CURL" ]; then
            echo "SITE3_CURL is not configured. Skipping..."
            exit 0
          fi
          
          echo "Executing custom cURL command for ${SITE_NAME}"
          echo "Command: ${CUSTOM_CURL}"
          
          # 设置cookie文件和响应文件
          COOKIE_FILE="${SITE_NAME}-cookies.txt"
          RESPONSE_FILE="${SITE_NAME}-last-response.json"
          
          # 执行cURL命令，添加cookie处理选项
          eval "${CUSTOM_CURL}" -c "${COOKIE_FILE}" > "${RESPONSE_FILE}"
          
          echo "${SITE_NAME}: Request completed successfully"
          
      - name: Execute Custom cURL for Site 4
        if: matrix.site.name == 'site4'
        env:
          CUSTOM_CURL: ${{ secrets.SITE4_CURL }}
          SITE_NAME: site4
        run: |
          # 检查是否配置了SITE4_CURL
          if [ -z "$CUSTOM_CURL" ]; then
            echo "SITE4_CURL is not configured. Skipping..."
            exit 0
          fi
          
          echo "Executing custom cURL command for ${SITE_NAME}"
          echo "Command: ${CUSTOM_CURL}"
          
          # 设置cookie文件和响应文件
          COOKIE_FILE="${SITE_NAME}-cookies.txt"
          RESPONSE_FILE="${SITE_NAME}-last-response.json"
          
          # 执行cURL命令，添加cookie处理选项
          eval "${CUSTOM_CURL}" -c "${COOKIE_FILE}" > "${RESPONSE_FILE}"
          
          echo "${SITE_NAME}: Request completed successfully"
          
      - name: Execute Custom cURL for Site 5
        if: matrix.site.name == 'site5'
        env:
          CUSTOM_CURL: ${{ secrets.SITE5_CURL }}
          SITE_NAME: site5
        run: |
          # 检查是否配置了SITE5_CURL
          if [ -z "$CUSTOM_CURL" ]; then
            echo "SITE5_CURL is not configured. Skipping..."
            exit 0
          fi
          
          echo "Executing custom cURL command for ${SITE_NAME}"
          echo "Command: ${CUSTOM_CURL}"
          
          # 设置cookie文件和响应文件
          COOKIE_FILE="${SITE_NAME}-cookies.txt"
          RESPONSE_FILE="${SITE_NAME}-last-response.json"
          
          # 执行cURL命令，添加cookie处理选项
          eval "${CUSTOM_CURL}" -c "${COOKIE_FILE}" > "${RESPONSE_FILE}"
          
          echo "${SITE_NAME}: Request completed successfully"
          
      - name: Execute Custom cURL for Site 6
        if: matrix.site.name == 'site6'
        env:
          CUSTOM_CURL: ${{ secrets.SITE6_CURL }}
          SITE_NAME: site6
        run: |
          # 检查是否配置了SITE6_CURL
          if [ -z "$CUSTOM_CURL" ]; then
            echo "SITE6_CURL is not configured. Skipping..."
            exit 0
          fi
          
          echo "Executing custom cURL command for ${SITE_NAME}"
          echo "Command: ${CUSTOM_CURL}"
          
          # 设置cookie文件和响应文件
          COOKIE_FILE="${SITE_NAME}-cookies.txt"
          RESPONSE_FILE="${SITE_NAME}-last-response.json"
          
          # 执行cURL命令，添加cookie处理选项
          eval "${CUSTOM_CURL}" -c "${COOKIE_FILE}" > "${RESPONSE_FILE}"
          
          echo "${SITE_NAME}: Request completed successfully"
          
      - name: Execute Custom cURL for Site 7
        if: matrix.site.name == 'site7'
        env:
          CUSTOM_CURL: ${{ secrets.SITE7_CURL }}
          SITE_NAME: site7
        run: |
          # 检查是否配置了SITE7_CURL
          if [ -z "$CUSTOM_CURL" ]; then
            echo "SITE7_CURL is not configured. Skipping..."
            exit 0
          fi
          
          echo "Executing custom cURL command for ${SITE_NAME}"
          echo "Command: ${CUSTOM_CURL}"
          
          # 设置cookie文件和响应文件
          COOKIE_FILE="${SITE_NAME}-cookies.txt"
          RESPONSE_FILE="${SITE_NAME}-last-response.json"
          
          # 执行cURL命令，添加cookie处理选项
          eval "${CUSTOM_CURL}" -c "${COOKIE_FILE}" > "${RESPONSE_FILE}"
          
          echo "${SITE_NAME}: Request completed successfully"
          
      - name: Execute Custom cURL for Site 8
        if: matrix.site.name == 'site8'
        env:
          CUSTOM_CURL: ${{ secrets.SITE8_CURL }}
          SITE_NAME: site8
        run: |
          # 检查是否配置了SITE8_CURL
          if [ -z "$CUSTOM_CURL" ]; then
            echo "SITE8_CURL is not configured. Skipping..."
            exit 0
          fi
          
          echo "Executing custom cURL command for ${SITE_NAME}"
          echo "Command: ${CUSTOM_CURL}"
          
          # 设置cookie文件和响应文件
          COOKIE_FILE="${SITE_NAME}-cookies.txt"
          RESPONSE_FILE="${SITE_NAME}-last-response.json"
          
          # 执行cURL命令，添加cookie处理选项
          eval "${CUSTOM_CURL}" -c "${COOKIE_FILE}" > "${RESPONSE_FILE}"
          
          echo "${SITE_NAME}: Request completed successfully"
          
      - name: Execute Custom cURL for Site 9
        if: matrix.site.name == 'site9'
        env:
          CUSTOM_CURL: ${{ secrets.SITE9_CURL }}
          SITE_NAME: site9
        run: |
          # 检查是否配置了SITE9_CURL
          if [ -z "$CUSTOM_CURL" ]; then
            echo "SITE9_CURL is not configured. Skipping..."
            exit 0
          fi
          
          echo "Executing custom cURL command for ${SITE_NAME}"
          echo "Command: ${CUSTOM_CURL}"
          
          # 设置cookie文件和响应文件
          COOKIE_FILE="${SITE_NAME}-cookies.txt"
          RESPONSE_FILE="${SITE_NAME}-last-response.json"
          
          # 执行cURL命令，添加cookie处理选项
          eval "${CUSTOM_CURL}" -c "${COOKIE_FILE}" > "${RESPONSE_FILE}"
          
          echo "${SITE_NAME}: Request completed successfully"
          
      - name: Execute Custom cURL for Site 10
        if: matrix.site.name == 'site10'
        env:
          CUSTOM_CURL: ${{ secrets.SITE10_CURL }}
          SITE_NAME: site10
        run: |
          # 检查是否配置了SITE10_CURL
          if [ -z "$CUSTOM_CURL" ]; then
            echo "SITE10_CURL is not configured. Skipping..."
            exit 0
          fi
          
          echo "Executing custom cURL command for ${SITE_NAME}"
          echo "Command: ${CUSTOM_CURL}"
          
          # 设置cookie文件和响应文件
          COOKIE_FILE="${SITE_NAME}-cookies.txt"
          RESPONSE_FILE="${SITE_NAME}-last-response.json"
          
          # 执行cURL命令，添加cookie处理选项
          eval "${CUSTOM_CURL}" -c "${COOKIE_FILE}" > "${RESPONSE_FILE}"
          
          echo "${SITE_NAME}: Request completed successfully"
          
      - name: Save Cookies For Next Run (${{ matrix.site.name }})
        uses: actions/upload-artifact@v4
        if: success() || failure()
        with:
          name: ${{ matrix.site.name }}-session-cookies
          path: ${{ matrix.site.name }}-cookies.txt
          if-no-files-found: ignore
          
      - name: Save Response For Analysis (${{ matrix.site.name }})
        uses: actions/upload-artifact@v4
        if: success() || failure()
        with:
          name: ${{ matrix.site.name }}-last-response
          path: ${{ matrix.site.name }}-last-response.json
          if-no-files-found: ignore